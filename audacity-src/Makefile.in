
INSTALL = @INSTALL@
exec_prefix= @exec_prefix@
prefix= @prefix@
BINDIR= @bindir@
DATADIR= @datadir@
MANDIR= @mandir@
ZIP = @ZIP@

.PHONY: all
all: audacity help/audacity.1.gz

.PHONY: audacity
audacity:
	$(MAKE) -C lib-src
	$(MAKE) -C src
	$(MAKE) -C locale

.PHONY: install
install: audacity audacity-help.htb
	# install the binary
	$(INSTALL) -d $(DESTDIR)$(BINDIR)
	$(INSTALL) -m 755 audacity $(DESTDIR)$(BINDIR)/audacity
	
	# install docs
	$(INSTALL) -d $(DESTDIR)$(DATADIR)/doc/audacity
	-test -f audacity-help.htb && $(INSTALL) -m 644 audacity-help.htb \
		$(DESTDIR)$(DATADIR)/doc/audacity/audacity-help.htb
	$(INSTALL) -m 644 README.txt $(DESTDIR)$(DATADIR)/doc/audacity/README.txt
	$(INSTALL) -m 644 LICENSE.txt $(DESTDIR)$(DATADIR)/doc/audacity/LICENSE.txt

	# install manpage
	$(INSTALL) -d $(DESTDIR)$(MANDIR)/man1
	-test -f help/audacity.1.gz && \
		$(INSTALL) -m 644 help/audacity.1.gz \
		$(DESTDIR)$(MANDIR)/man1
	$(INSTALL) -d $(DESTDIR)$(DATADIR)/audacity/nyquist
	$(INSTALL) -m 644 nyquist/*.lsp $(DESTDIR)$(DATADIR)/audacity/nyquist
	$(INSTALL) -d $(DESTDIR)$(DATADIR)/audacity/plug-ins
	$(INSTALL) -m 644 plug-ins/*.ny $(DESTDIR)$(DATADIR)/audacity/plug-ins

	# install locales
	$(MAKE) -C locale install

uninstall:
	rm -rf $(BINDIR)/audacity
	rm -rf $(DATADIR)/doc/audacity
	rm -rf $(DATADIR)/audacity
	rm -rf $(MANDIR)/man1/audacity.1.gz

	$(MAKE) -C locale uninstall

help/audacity.1.gz:
	# gzipping the file this way prevents audacity.1 from getting deleted
	cat help/audacity.1 | gzip -9 > help/audacity.1.gz

audacity-help.htb: help/wxhelp/*
	rm -f audacity-help.htb
	cd help/wxhelp && $(ZIP) ../../audacity-help.htb *.htm *.png *.hhc *.hhk *.hhp

dox:
	doxygen audacity.dox

dep:
	$(MAKE) -C src dep

clean:
	$(MAKE) -C lib-src clean
	$(MAKE) -C src clean
	rm -f audacity-help.htb
	rm -f audacity
	rm -f help/audacity.1.gz

veryclean: clean
	rm -f Makefile src/Makefile lib-src/Makefile
	rm -f src/configunix.h
	rm -f `find . -name "*~"`
	rm -f `find . -name core`

distclean: clean
	$(MAKE) -C locale distclean
	$(MAKE) -C lib-src distclean

	rm -f Makefile src/Makefile lib-src/Makefile lib-src/allegro/Makefile
	rm -f locale/Makefile src/configunix.h
	rm -f config.log config.status

