########################################
#
# Audacity Makefile
#
# Dominic Mazzoni
#
# Run configure to generate Makefile
# from Makefile.in
#

LIBFLAGS = -Lxaudio/linux/lib -lxaudio @LIBS@
CFLAGS = @DEFS@ @CFLAGS@ @CPPFLAGS@ -Iallegro
CCC = @CXX@
CC = @CC@

########################################
# ALL OBJECT FILES

OBJDIR = obj

OBJS = \
	$(OBJDIR)/AButton.cpp.o \
	$(OBJDIR)/AColor.cpp.o \
	$(OBJDIR)/APalette.cpp.o \
	$(OBJDIR)/ASlider.cpp.o \
	$(OBJDIR)/AStatus.cpp.o \
	$(OBJDIR)/AboutDialog.cpp.o \
	$(OBJDIR)/AudacityApp.cpp.o \
	$(OBJDIR)/AudioIO.cpp.o \
	$(OBJDIR)/BlockFile.cpp.o \
	$(OBJDIR)/DirManager.cpp.o \
	$(OBJDIR)/DiskFunctions.cpp.o \
	$(OBJDIR)/Envelope.cpp.o \
	$(OBJDIR)/Export.cpp.o \
	$(OBJDIR)/FFT.cpp.o \
	$(OBJDIR)/FreqWindow.cpp.o \
	$(OBJDIR)/Help.cpp.o \
	$(OBJDIR)/Import.cpp.o \
	$(OBJDIR)/ImportMIDI.cpp.o \
	$(OBJDIR)/ImportMP3.cpp.o \
	$(OBJDIR)/ImportOGG.cpp.o \
	$(OBJDIR)/ImportRaw.cpp.o \
	$(OBJDIR)/LabelTrack.cpp.o \
	$(OBJDIR)/Menus.cpp.o \
	$(OBJDIR)/Mix.cpp.o \
	$(OBJDIR)/NoteTrack.cpp.o \
	$(OBJDIR)/Prefs.cpp.o \
	$(OBJDIR)/Project.cpp.o \
	$(OBJDIR)/Spectrum.cpp.o \
	$(OBJDIR)/Track.cpp.o \
	$(OBJDIR)/TrackArtist.cpp.o \
	$(OBJDIR)/TrackPanel.cpp.o \
	$(OBJDIR)/UndoManager.cpp.o \
	$(OBJDIR)/WaveTrack.cpp.o \
	$(OBJDIR)/allegro/allegro.cpp.o \
	$(OBJDIR)/allegro/allegrowr.cpp.o \
	$(OBJDIR)/allegro/mfallegro.cpp.o \
	$(OBJDIR)/allegro/mfmidi.cpp.o \
	$(OBJDIR)/allegro/strparse.cpp.o \
	$(OBJDIR)/allegro/stimelinux.c.o \
	$(OBJDIR)/effects/Effect.cpp.o \
	$(OBJDIR)/effects/Amplify.cpp.o \
	$(OBJDIR)/effects/Echo.cpp.o \
	$(OBJDIR)/effects/Fade.cpp.o \
	$(OBJDIR)/effects/Filter.cpp.o \
	$(OBJDIR)/snd/audiooss.c.o \
	$(OBJDIR)/snd/ieeecvt.c.o \
	$(OBJDIR)/snd/snd.c.o \
	$(OBJDIR)/snd/sndheader.c.o \
	$(OBJDIR)/snd/sndlinux.c.o \
	$(OBJDIR)/snd/sndcvt.c.o \
	$(OBJDIR)/snd/sndio.c.o \
	$(OBJDIR)/prefs/PrefsDialog.cpp.o \
	$(OBJDIR)/prefs/AudioIOPrefs.cpp.o \
	$(OBJDIR)/prefs/SampleRatePrefs.cpp.o \
	$(OBJDIR)/prefs/FileFormatPrefs.cpp.o \
	$(OBJDIR)/prefs/SpectrumPrefs.cpp.o

########################################
# DEPENDENCIES

DEPS = $(OBJS:$(OBJDIR)/%.o=%)

########################################

all: dirs audacity

audacity: $(OBJS) Makefile
	$(CCC) -o audacity $(OBJS) $(LIBFLAGS)

#
# You can optionally "make dep" to make dependencies.
# voodoo magic in the form of a perl script turns
# Foo.o: Foo.cpp into obj/Foo.cpp.o: Foo.cpp
#
# I'm not brave enough to try and translate that regex to sed

dep:
	$(CCC) -M $(CFLAGS) $(DEPS) | \
		perl -pe 's/^(.*)\.o: ([^\/]*\/)??([^ \/]+\.(\w+))/$(OBJDIR)\/$$2$$1.$$4.o: $$2$$3/;' \
		> .depend

#
# clean: Get rid of executable, dependencies, and all object files
#

clean:
	rm -f audacity .depend
	rm -rf obj/

#
# We stick object files in separate directories for convenience
#

dirs: obj obj/snd obj/effects obj/prefs obj/allegro

obj:
	mkdir obj

obj/allegro:
	mkdir obj/allegro

obj/snd:
	mkdir obj/snd

obj/effects:
	mkdir obj/effects

obj/prefs:
	mkdir obj/prefs

#
# Rules for compiling C/C++ files
#

$(OBJDIR)/%.cpp.o: %.cpp
	$(CCC) -c $(CFLAGS) $< -o $@

$(OBJDIR)/%.c.o: %.c
	$(CC) -c $(CFLAGS) $< -o $@

#
# Include ".depend" if it exists (run "make dep" to generate it)
#

ifeq (.depend,$(wildcard .depend))
include .depend
endif

